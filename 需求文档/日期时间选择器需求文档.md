# 日期时间选择器需求文档

## 功能描述
在需求管理界面中添加日期选择功能，支持开始日期、结束日期的选择，并根据人天数自动计算结束日期。

## 实现方案

### 1. 日期选择器配置
- **开始日期选择器 (da_start_date)**:
  - 使用 QDateEdit 组件
  - 启用日历弹出功能 (setCalendarPopup(True))
  - 设置日期格式为 'yyyy-MM-dd'
  - 默认显示当前日期
  - 设置日期范围 2020-01-01 到 2050-12-31

- **结束日期选择器 (da_end_date)**:
  - 使用 QDateEdit 组件
  - 启用日历弹出功能
  - 设置相同的日期格式和范围
  - 可自动根据人天数计算，也可手动选择

### 2. 人天计算功能
- **人天输入框 (li_rentian)**:
  - 使用 QLineEdit 组件
  - 添加 QIntValidator 验证器，只允许输入整数
  - 默认值为 '0'
  - 支持实时计算结束日期

### 3. 自动计算逻辑
```python
def f_li_rentian(self):
    # 根据人天，计算结束时间
    rentian = self.li_rentian.text()
    if rentian == '':
        return
    try:
        rentian = int(rentian)
    except ValueError:
        QMessageBox.warning(self, '错误', '请输入有效的数字')
        return
    
    start_date = self.da_start_date.date()
    # 使用 QDate 的 addDays 方法进行日期计算
    end_date = start_date.addDays(rentian)
    self.da_end_date.setDate(end_date)
```

## 技术要点

### 1. 正确的导入方式
```python
from PySide6.QtWidgets import QDateEdit, QLineEdit
from PySide6.QtCore import QDate
from PySide6.QtGui import QIntValidator
```

### 2. 日期计算方法
- **错误方式**: `QDate + datetime.timedelta` ❌
- **正确方式**: `QDate.addDays(days)` ✅

### 3. 日历弹出配置
```python
# 配置日期选择器
self.da_start_date.setDate(QDate.currentDate())        # 设置当前日期
self.da_start_date.setCalendarPopup(True)              # 启用日历弹出
self.da_start_date.setDisplayFormat('yyyy-MM-dd')      # 设置显示格式
self.da_start_date.setDateRange(QDate(2020, 1, 1), QDate(2050, 12, 31))  # 设置日期范围
```

### 4. 输入验证
```python
# 限制输入只能为整数
self.li_rentian.setValidator(QIntValidator())
# 连接文本变化信号
self.li_rentian.textChanged.connect(self.f_li_rentian)
```

## 实现效果
1. **日历弹出**: 点击日期输入框右侧下拉箭头，弹出美观的日历选择界面
2. **月份导航**: 可通过左右箭头切换月份和年份
3. **日期高亮**: 当前选中的日期会高亮显示
4. **自动计算**: 输入人天数后，自动计算并设置结束日期
5. **输入验证**: 人天输入框只接受数字输入，无效输入会弹出警告

## 文件修改
- `xuqiu.py`: 修正日期计算逻辑，完善日期选择器配置

## 错误修正记录
1. **修正日期运算错误**: 将 `QDate + datetime.timedelta` 改为 `QDate.addDays()`
2. **添加输入验证**: 增加数字验证和错误提示
3. **完善日历配置**: 为结束日期也添加日历弹出功能

## 注释说明
代码中添加了详细的中文注释，包括：
- 组件初始化说明
- 日期计算逻辑解释
- 错误处理说明
- 配置参数含义

这样确保不懂编程的人也能理解代码的功能和实现原理。 